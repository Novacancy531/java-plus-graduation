![pic](pic.png)

# Explore With Me — Microservices Architecture
## Описание проекта

**Explore With Me** — серверное приложение, реализующее платформу для публикации событий, подачи заявок на участие, комментирования и сбора статистики просмотров.

Внешне API описано как единый сервис, однако фактически приложение реализовано в виде набора независимых микросервисов, каждый из которых отвечает за свою предметную область.
Такой подход позволяет повысить масштабируемость, отказоустойчивость и упростить сопровождение проекта.

## Архитектура

Проект построен по микросервисной архитектуре с использованием **Spring Boot** и **Spring Cloud**.

### Состав сервисов

#### Инфраструктурные сервисы

- **config-server** — централизованное хранилище конфигураций

- **discovery-server** — сервис регистрации и обнаружения (Eureka)

- **gateway-server** — единая точка входа в систему

#### Бизнес-сервисы

- **event-service** — управление событиями, категориями и подборками

- **user-service** — управление пользователями

- **request-service** — заявки на участие в событиях

- **comment-service** — комментарии к событиям

- **stats-service** — сбор и агрегация статистики просмотров

#### Общие модули

- **common** — общие DTO, контракты API, исключения

- **core** — parent-модуль и агрегация сервисов

- **infra** — инфраструктурные сервисы

### Взаимодействие сервисов

Все межсервисные вызовы выполняются синхронно через Feign-клиенты
и защищены механизмами отказоустойчивости.

#### Схема взаимодействия

- **event-service**
  - **→ user-service**
  - **→ request-service**
  - **→ stats-service**
- **comment-service**
  - **→ user-service**
  - **→ event-service**
- **request-service**
  - **→ user-service**
  - **→ event-service**

### Надёжность

- **Feign Client** — для межсервисных REST-вызовов
- **Resilience4j** (**Circuit Breaker**) — защита от каскадных отказов
- **Spring Retry** — повтор запросов при временных сбоях
- При недоступности зависимого сервиса используется fallback-логика

### Внешний API

Несмотря на микросервисную реализацию, внешний API соответствует единому контракту, описанному в OpenAPI-спецификациях:

- Основной API - [**ewm-main-service-spec.json**](ewm-main-service-spec.json)
- API сервиса статистики - [**ewm-stats-service-spec.json**](ewm-stats-service-spec.json)

Доступ клиентов осуществляется через **gateway-server**.

## Технологический стек

- **Java 21**
- **Maven (multi-module)**
- **Spring Boot 3.5.7**
- **Spring Cloud 2025.0.0**

### Основные зависимости микросервисов
- **Spring Web**
- **Spring Data JPA**
- **Spring Validation**
- **Spring Actuator**
- **Spring Cloud OpenFeign**
- **Spring Cloud Eureka Client**
- **Spring Cloud Config Client**
- **Spring Cloud LoadBalancer**
- **Spring Retry**
- **Resilience4j (Circuit Breaker)**
- **PostgreSQL**
- **MapStruct**
- **Lombok**
- **Zalando Logbook**

### Работа с БД
- **JPA / Hibernate**
- **QueryDSL**


## Тестирование

Для проверки корректности работы системы используются Postman-коллекции, покрывающие как отдельные сервисы, так и их взаимодействие.

### Тесты сервиса статистики

**Postman Collection:** [**Explore With Me Plus - Stat - Microservices**](postman/ewm-stat-service.json)

#### Проверяется:

- POST /hit → сохранение информации о запросе

- GET /stats → получение статистики

- Корректность подсчёта hits

- Сортировка по убыванию просмотров

- Параметр unique=true

- Обработка ошибок (400 при неверных датах)

#### Дополнительно:

- baseUrl stats-service определяется динамически через Eureka

### Тесты основных сервисов

**Postman Collection:** [**Explore With Me Plus - Main - Microservices**](postman/ewm-main-service.json)

#### Проверяются:

- Пользователи (/admin/users)

- Категории (/admin/categories)

- События (private / public / admin API)

- Заявки на участие

- Бизнес-ограничения (409 Conflict)

- Валидация запросов (400 Bad Request)

- Корректность ответов и статусов

## Конфигурация и запуск

- Конфигурации сервисов хранятся в **config-server**
- Все сервисы регистрируются в **discovery-server**
- Внешние запросы проходят через **gateway-server**
- Базы данных — **PostgreSQL**, отдельная для каждого сервиса

## Итог
В рамках проекта реализовано микросервисное приложение с единым внешним API и внутренним разделением на независимые сервисы по предметным областям.
Реализация выполнена в виде набора микросервисов, взаимодействующих между собой по REST.

Приложение предназначено для работы с событиями и предоставляет функциональность по управлению пользователями, публикации и поиску событий, подаче заявок на участие, комментированию, а также сбору и анализу статистики просмотров. Вся бизнес-логика распределена между сервисами в соответствии с их зоной ответственности, что обеспечивает слабую связанность компонентов и упрощает развитие системы.

Архитектура приложения включает централизованную конфигурацию, сервис обнаружения, единый вход через gateway и устойчивые межсервисные взаимодействия с использованием **Feign**, **Circuit Breaker** и **Retry**. Это позволяет системе корректно обрабатывать запросы даже при частичной недоступности отдельных сервисов и делает решение готовым к масштабированию и дальнейшему сопровождению.